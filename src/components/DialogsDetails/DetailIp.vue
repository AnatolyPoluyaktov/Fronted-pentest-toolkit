<template>
    <div>
        <v-row justify="center">

            <v-dialog v-model="dialog" fullscreen hide-overlay transition="dialog-bottom-transition" scrollable>
                <v-card tile>
                    <v-toolbar class="flex-grow-0" flat dark color="primary">
                        <v-btn icon dark @click="$emit('close')">
                            <v-icon>mdi-close</v-icon>
                        </v-btn>
                        <v-toolbar-title>Ip Info: {{ip.ip}}</v-toolbar-title>
                        <v-spacer></v-spacer>


                    </v-toolbar>

                    <v-container fluid>
                        <v-flex md7>
                            <v-subheader>Ip meta</v-subheader>
                            <v-simple-table fixed-header height="300px">
                                <template v-slot:default>

          <tbody>
            <tr
              v-for="item in propeties"
              :key="item.name"
            >
              <td>{{ item.name }}</td>
              <td>{{ item.value }}</td>
            </tr>
          </tbody>
</template>
  </v-simple-table>
</v-flex>
</v-container >

            <v-card-text>


              <v-divider></v-divider>

              <v-list
                three-line
                subheader
              >

                <v-list-item>
                  <CardEntities :mydata="data_for_card" />

                </v-list-item>


              </v-list>

            </v-card-text>

            <div style="flex: 1 1 auto;"></div>
          </v-card>
        </v-dialog>


      </v-row>

    </div>
  </template>

<script>
import http from "@/http";
import CardEntities from '../cards/CardEntities.vue';
export default {
    components: {
        CardEntities
    },
    props: {
        dialog: {
            type: Boolean,
            default: false
        },
        ip_id: {
            type: Number,
            default: 1
        },
    },
    name: "DetailIp",
    data() {
        return {

            propeties: [ ],

            loader: null,
            loading: false,
            widgets: false,

            ip: {},

            data_for_card: []
        }

    },

    methods: {
        async getIpInfo() {
            console.log("getIpInfo",this.i_id);
            let response = (await http.getItem("common/ips/", this.ip_id)).data;
            this.ip = response;
            this.propeties = []
            let project_name = (await http.getItem("common/projects/", this.ip.project)).data.name;

            let subnet = this.ip.subnet;
            if (subnet == null) {
                subnet = null
            } else {
                subnet = (await http.getItem("common/subnets/", this.ip.subnet)).data.subnet;
            }


            this.propeties.push({ name: "db id", value: this.ip_id})
            this.propeties.push({ name: 'Ip Address', value: this.ip.ip })
            this.propeties.push({ name: 'Project name', value:project_name })
            this.propeties.push({ name: 'status', value: this.ip.status })
            this.propeties.push({ name: 'subnet', value: subnet })
            this.propeties.push({ name: 'source', value: this.ip.source })
            this.propeties.push({ name: 'created_at', value: this.ip.created_at })
            this.propeties.push({ name: 'updated_at', value: this.ip.updated_at })
            this.propeties.push({ name: 'last_scanned_at', value: this.ip.last_scanned_at })
            this.propeties.push({ name: 'subdomain number', value: this.ip.subdomains.length })
            this.propeties.push({ name: 'domain number', value: this.ip.subdomains.length })

           this.prepareDataForCard()


        },


        prepareDataForCard() {
            this.data_for_card = []

            this.data_for_card.push({
                title: 'Domains',
                data: this.ip.domains
            })
            this.data_for_card.push({
                title: 'Subdomains',
                data: this.ip.subdomains
            })

            console.log(this.data_for_card)


        }
    },


    watch: {
        dialog(val) {
            if (val) {
               this.getIpInfo()

            }


        },

    },
}
</script>

<style lang="scss" scoped>
td {
    width: 50px;
}
</style>
