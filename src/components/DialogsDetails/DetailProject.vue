<template>
  <v-dialog
        v-model="dialog"
        fullscreen
        hide-overlay
        transition="dialog-bottom-transition"
        scrollable
      >


        <v-card tile>
          <v-toolbar
            flat
            dark
            color="primary"
          >
            <v-btn
              icon
              dark
              @click="dialog = false"
            >
              <v-icon>mdi-close</v-icon>
            </v-btn>
            <v-toolbar-title>Settings</v-toolbar-title>
            <v-spacer></v-spacer>
            <v-toolbar-items>

            </v-toolbar-items>
            <v-menu
              bottom
              right
              offset-y
            >
              <template v-slot:activator="{ on, attrs }">
                <v-btn
                  dark
                  icon
                  v-bind="attrs"
                  v-on="on"
                >
                  <v-icon>mdi-dots-vertical</v-icon>
                </v-btn>
              </template>

            </v-menu>
          </v-toolbar>
          <v-card-text>

            <v-tooltip right>
              <template v-slot:activator="{ on, attrs }">
                <v-btn
                  class="ma-2"
                  v-bind="attrs"
                  v-on="on"
                >
                  Tool Tip Activator
                </v-btn>
              </template>
              Tool Tip
            </v-tooltip>

            <v-list
              three-line
              subheader
            >
              <v-subheader>User Controls</v-subheader>
              <v-list-item>
                <v-list-item-content>
                  <v-list-item-title>Content filtering</v-list-item-title>
                  <v-list-item-subtitle>Set the content filtering level to restrict apps that can be downloaded</v-list-item-subtitle>
                </v-list-item-content>
              </v-list-item>
              <v-list-item>
                <v-list-item-content>
                  <v-list-item-title>Password</v-list-item-title>
                  <v-list-item-subtitle>Require password for purchase or use password to restrict purchase</v-list-item-subtitle>
                </v-list-item-content>
              </v-list-item>
            </v-list>
            <v-divider></v-divider>
            <v-row align="center">
    <v-col cols="12">
      <v-select

          v-model="selector"
          label="Selector"
          :items="services"
      >

    </v-select>
    </v-col>
  </v-row>
  <v-select

        ></v-select>
  <v-card-title class="white--text orange darken-4">
      Services
      </v-card-title>

          </v-card-text>

          <div style="flex: 1 1 auto;"></div>
        </v-card>
      </v-dialog>

</template>

<script>
import http from "@/http";
import Observer from "@/components/Observer.vue";

  export default {
    components: {
Observer
    },
    props:{
      dialog: {
        type: Boolean,
        default: false
      },
     project_id: {
        type: Number,
        default: 1
      },
    },
    data () {
      return {
        type: 'object',
        benched: 0,
        page: 0,
        loader: null,
        loading: false,
        selector: {},
        services: [],
        project: {},
        loading:true,
        page_related: 1,
        service:{}
      }

    },

    methods: {
     async getProjectInfo() {

        let response = (await http.getItem("common/projects/", this.project_id)).data;
        this.project = response;



      },
      forceFileDownload(response) {
      const url = window.URL.createObjectURL(new Blob([response.data]))
      const link = document.createElement('a')
      link.href = url
      link.setAttribute('download', "report.csv")
      document.body.appendChild(link)
      link.click()
    },
      async DownloadCsvServices() {
        console.log("DownloadCsvServices");
        let response = (await http.dowload_csv_services("Projects", this.project_id)).data;
        this.forceFileDownload(response)


      },

      intersected() {
        console.log("intersected");
        this.retrieveServices();
      },
      retrieveServices() {
        this.loading=true
       this.page_related += 1;
      const params = {project:
        this.project_id,
        page: this.page_related,
        per_page: 20,
      }
      http.getList("Services",params, true)

        .then((response) => {
          const { count,results, total_pages } = response.data;
          this.totalservices = count;
          this.services=[...results.map(function(element){

            return {
              ip: element.ip,
              port: element.port,
            }
          })];
          this.loading=false
          console.log(this.services)
          this.totalPages = total_pages;

        })
        .catch((e) => {
          console.log(e);
        });
    }},



    watch : {
      dialog(val) {
        if (val) {
          this.getProjectInfo()
          this.retrieveServices()

        }


      },

    },
  }
</script>
