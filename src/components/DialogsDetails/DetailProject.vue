<template>
  <div>
    <v-row
      justify="center"
    >

      <v-dialog
        v-model="dialog"
        fullscreen
        hide-overlay
        transition="dialog-bottom-transition"
        scrollable
      >
        <v-card tile>
          <v-toolbar
            flat
            dark
            color="primary"
          >
            <v-btn
              icon
              dark
              @click="$emit('close')"
            >
              <v-icon>mdi-close</v-icon>
            </v-btn>
            <v-toolbar-title>Detail info of Project: {{project.name}}</v-toolbar-title>
            <v-spacer></v-spacer>


          </v-toolbar>
          <v-card-text>

            <v-btn

      color="blue-grey"
      class="ma-2 white--text"
      @click="DownloadCsvServices"
    >
      CSV report: Services
      <v-icon
        right
        dark
      >
        mdi-cloud-download
      </v-icon>
    </v-btn>

            <v-divider></v-divider>
            <v-list
              three-line
              subheader
            >

              <v-list-item>
                <CardEntities :mydata="data_for_card" />

              </v-list-item>


            </v-list>

          </v-card-text>

          <div style="flex: 1 1 auto;"></div>
        </v-card>
      </v-dialog>


    </v-row>

  </div>
</template>

<script>
import http from "@/http";
import CardEntities from '../cards/CardEntities.vue';
  export default {
    components: {
      CardEntities
    },
    props:{
      dialog: {
        type: Boolean,
        default: false
      },
     project_id: {
        type: Number,
        default: 1
      },
    },
    data () {
      return {

        loader: null,
        loading: false,
        widgets: false,

        project: {},

        data_for_card: []
      }

    },

    methods: {
     async getProjectInfo() {

        let response = (await http.getItem("common/projects/", this.project_id)).data;
        this.project = response;
      },
      forceFileDownload(response) {
      const url = window.URL.createObjectURL(new Blob([response.data]))
      const link = document.createElement('a')
      link.href = url
      link.setAttribute('download', "report.csv")
      document.body.appendChild(link)
      link.click()
    },
      async DownloadCsvServices() {
        console.log("DownloadCsvServices");
        let response = (await http.dowload_csv_services("Projects", this.project_id)).data;
        this.forceFileDownload(response)


      },
      prepareDataForCard(){
        this.data_for_card = []
        this.data_for_card.push({
          title: 'Domains',
          data: this.project.domains
        })
        this.data_for_card.push({
          title: 'IPs',
          data: this.project.ips
        })

        this.data_for_card.push({
          title: 'Subdomains',
          data: this.project.subdomains
        })

        this.data_for_card.push({
          title: 'Services',
          data: this.project.services
        })

        this.data_for_card.push({
          title: 'Endpoints',
          data: this.project.endpoints
        })

        this.data_for_card.push({
          title: 'Emails',
          data: this.project.emails
        })

        console.log(this.data_for_card)



      }
    },
    loader(){

    },

    watch : {
      dialog(val) {
        if (val) {
          this.getProjectInfo()
        this.prepareDataForCard()
        }


      },

    },
  }
</script>
