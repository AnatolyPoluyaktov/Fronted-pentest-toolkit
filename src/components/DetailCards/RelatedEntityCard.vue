<template>
    <v-dialog
         v-model="dialog"
         scrollable
         max-width="500px"
         @click:outside="closeDialog"
       >
         <template v-slot:activator="{ on, attrs }">
           <v-btn
             color="primary"
             dark
             v-bind="attrs"
             v-on="on"
           >
             Open Dialog
           </v-btn>
         </template>
         <v-card>
           <v-card-title>{{ title }} (total: {{ total_items }})</v-card-title>
           <v-divider></v-divider>
           <v-card-text style="height: 300px;">
               <v-list-item
           v-for="(item, index) in items"
           :key="index"
           >


             <v-list-item-content>
               <v-list-item-title>{{ item.property }}</v-list-item-title>
             </v-list-item-content>


           </v-list-item>



           <v-card v-intersect="infiniteScrolling">

   </v-card>
           </v-card-text>
           <v-divider></v-divider>
           <v-card-actions>
                                        <v-spacer></v-spacer>
                                        <v-btn color="blue darken-1" text @click="$emit('close')" >Cancel</v-btn>

                                        <v-spacer></v-spacer>
                                    </v-card-actions>
         </v-card>
       </v-dialog>

         <!--Add here the vuetify directive -->


     </template>

     <script>
     import http from "@/http";
     import axios from "axios";

     export default {
        props: {
            title : {
                type: String,
                default: "Title"
            },
            dialog: {
                type: Boolean,
                default: false
            },
            width : {
                type: String,
                default: "500px"
            },
            filter:{
                type: Object,
                default: () => ({})
            },
            url: {
                type: String,
                default: "https://jsonplaceholder.typicode.com/posts?_page=1"
            },
            property: {
                type: String,
                default: "body"
            }
        },
       name: "Posts",
       data() {
         return {
           items: [],
           page: 1,
           total_items: 0,
         };
       },
       computed: {
          x()
          {
              return "500px"
          }
       },
       created() {
         this.fetchData();
       },
       methods: {
         async fetchData() {
          let params = this.getparams()

http.getList(this.url, params, true)
    .then((response) => {
        const { count, results, total_pages } = response.data;
        this.total_items = count;
        this.items.push(...results.map(this.getDisplayItem));

        console.log(response.data);
    })
    .catch((e) => {
        console.log(e);
    });
         },
         getparams(){
            console.log(this.filter);
                return {
                    ...this.filter,
                    page: this.page,
                    per_page: 20,
                }
         },
         infiniteScrolling(entries, observer, isIntersecting) {
           setTimeout(() => {

             this.page++;
             let params = this.getparams()

            http.getList(this.url, params, true)
                .then((response) => {
                    const { count, results, total_pages } = response.data;
                    this.total_items = count;
                    this.items.push(...results.map(this.getDisplayItem));

                    console.log(response.data);
                })
                .catch((e) => {
                    console.log(e);
                });

           }, 500);
         },
         closeDialog() {
           this.$emit("close")
         },
         getDisplayItem(item) {
           return {
             property: item[this.property],
           };
         },
       }
     };
     </script>

     <style scoped>
     .theme--light.v-card {
       background-color: #f5f5f5;
     }
     </style>
