<template>
  <v-app id="inspire" :style="{background: $vuetify.theme.themes.dark.background}" >



    <v-container v-if="statistics"  >

     <v-item-group mandatory class="mt-n4">
      <v-container>
        <v-row justify="center" class="space">
          <v-col
            cols="12"
            md="2"
          >
            <v-item v-slot="{ active, toggle }" >
             <v-card
                :color="active ? '#49D9A0' : 'white'"
                class="d-flex align-center rounded-xl"
                dark
                height="200"
                @click="toggle"

              >
                <v-row>
                  <v-col cols="12" sm="12">
                    <v-list-item three-line  class="mt-10">
                      <v-list-item-content>
                        <div class="mb-4">

                            <v-icon  x-large :color="active ? 'white' : '#49D9A0'">fas fa-chart-bar</v-icon>

                        </div>
                        <v-list-item-subtitle :class="active ? 'white--text' : 'black--text'">Projects</v-list-item-subtitle>
                        <v-list-item-title class="headline mb-1" :class="active ? 'white--text' : 'black--text'">
                          <strong>{{ statistics.total_projects }}</strong>
                        </v-list-item-title>

                      </v-list-item-content>
                    </v-list-item>
                  </v-col>
                </v-row>

              </v-card>
            </v-item>
          </v-col>
           <v-col
            cols="12"
            md="2"
          >
            <v-item v-slot="{ active, toggle }">
              <v-card
                :color="active ? '#49D9A0' : 'white'"
                class="d-flex align-center rounded-xl"
                dark
                height="200"
                @click="toggle"
              >
                <v-row>
                  <v-col cols="12" sm="12">
                    <v-list-item three-line  class="mt-10">
                      <v-list-item-content>
                        <div class="mb-4">

                            <v-icon  x-large :color="active ? 'white' : '#49D9A0'">far fa-user</v-icon>

                        </div>
                        <v-list-item-subtitle :class="active ? 'white--text' : 'black--text'">Domains</v-list-item-subtitle>
                        <v-list-item-title class="headline mb-1" :class="active ? 'white--text' : 'black--text'">
                          <strong>{{ statistics.total_domains }}</strong>
                        </v-list-item-title>

                      </v-list-item-content>
                    </v-list-item>
                  </v-col>
                </v-row>

              </v-card>
            </v-item>
          </v-col>
          <v-col
            cols="12"
            md="2"
          >
            <v-item v-slot="{ active, toggle }">
              <v-card
                :color="active ? '#49D9A0' : 'white'"
                class="d-flex align-center rounded-xl"
                dark
                height="200"
                @click="toggle"
              >
                <v-row>
                  <v-col cols="12" sm="12">
                    <v-list-item three-line  class="mt-10">
                      <v-list-item-content>
                        <div class="mb-4">

                            <v-icon  x-large :color="active ? 'white' : '#49D9A0'">far fa-user</v-icon>

                        </div>
                        <v-list-item-subtitle :class="active ? 'white--text' : 'black--text'">Subdomains</v-list-item-subtitle>
                        <v-list-item-title class="headline mb-1" :class="active ? 'white--text' : 'black--text'">
                          <strong>{{ statistics.total_subdomains }}</strong>
                        </v-list-item-title>

                      </v-list-item-content>
                    </v-list-item>
                  </v-col>
                </v-row>

              </v-card>
            </v-item>
          </v-col>
           <v-col
            cols="12"
            md="2"
          >
            <v-item v-slot="{ active, toggle }">
             <v-card
                :color="active ? '#49D9A0' : 'white'"
                class="d-flex align-center rounded-xl"
                dark
                height="200"
                @click="toggle"
              >
                <v-row>
                  <v-col cols="12" sm="12">
                    <v-list-item three-line  class="mt-10">
                      <v-list-item-content>
                        <div class="mb-4">

                            <v-icon  x-large :color="active ? 'white' : '#49D9A0'">fas fa-suitcase</v-icon>

                        </div>
                        <v-list-item-subtitle :class="active ? 'white--text' : 'black--text'">IPs</v-list-item-subtitle>
                        <v-list-item-title class="headline mb-1" :class="active ? 'white--text' : 'black--text'">
                          <strong>{{ statistics.total_ips }}</strong>
                        </v-list-item-title>

                      </v-list-item-content>
                    </v-list-item>
                  </v-col>
                </v-row>

              </v-card>
            </v-item>
          </v-col>

           <v-col
            cols="12"
            md="2"
          >
            <v-item v-slot="{ active, toggle }">
              <v-card
                :color="active ? '#49D9A0' : 'white'"
                class="d-flex align-center rounded-xl"
                dark
                height="200"
                @click="toggle"
              >
                <v-row>
                  <v-col cols="12" sm="12">
                    <v-list-item three-line  class="mt-10">
                      <v-list-item-content>
                        <div class="mb-4">

                            <v-icon  x-large :color="active ? 'white' : '#49D9A0'">fas fa-search</v-icon>

                        </div>
                        <v-list-item-subtitle :class="active ? 'white--text' : 'black--text'">Subnets</v-list-item-subtitle>
                        <v-list-item-title class="headline mb-1" :class="active ? 'white--text' : 'black--text'">
                          <strong>{{ statistics.total_subnets }}</strong>
                        </v-list-item-title>

                      </v-list-item-content>
                    </v-list-item>
                  </v-col>
                </v-row>

              </v-card>
            </v-item>
          </v-col>

           <v-col
            cols="12"
            md="2"
          >
            <v-item v-slot="{ active, toggle }">
              <v-card
                :color="active ? '#49D9A0' : 'white'"
                class="d-flex align-center rounded-xl"
                dark
                height="200"
                @click="toggle"
              >
                <v-row>
                  <v-col cols="12" sm="12">
                    <v-list-item three-line  class="mt-10">
                      <v-list-item-content>
                        <div class="mb-4">

                            <v-icon  x-large :color="active ? 'white' : '#49D9A0'">fas fa-search</v-icon>

                        </div>
                        <v-list-item-subtitle :class="active ? 'white--text' : 'black--text'">Services</v-list-item-subtitle>
                        <v-list-item-title class="headline mb-1" :class="active ? 'white--text' : 'black--text'">
                          <strong>{{ statistics.total_services }}</strong>
                        </v-list-item-title>

                      </v-list-item-content>
                    </v-list-item>
                  </v-col>
                </v-row>

              </v-card>
            </v-item>
          </v-col>

          <v-col
            cols="12"
            md="2"
          >
            <v-item v-slot="{ active, toggle }">
              <v-card
                :color="active ? '#49D9A0' : 'white'"
                class="d-flex align-center rounded-xl"
                dark
                height="200"
                @click="toggle"
              >
                <v-row>
                  <v-col cols="12" sm="12">
                    <v-list-item three-line  class="mt-10">
                      <v-list-item-content>
                        <div class="mb-4">

                            <v-icon  x-large :color="active ? 'white' : '#49D9A0'">fas fa-search</v-icon>

                        </div>
                        <v-list-item-subtitle :class="active ? 'white--text' : 'black--text'">Web Origins</v-list-item-subtitle>
                        <v-list-item-title class="headline mb-1" :class="active ? 'white--text' : 'black--text'">
                          <strong>{{ statistics.total_web_origins }}</strong>
                        </v-list-item-title>

                      </v-list-item-content>
                    </v-list-item>
                  </v-col>
                </v-row>

              </v-card>
            </v-item>
          </v-col>
          <v-col
            cols="12"
            md="2"
          >
            <v-item v-slot="{ active, toggle }">
              <v-card
                :color="active ? '#49D9A0' : 'white'"
                class="d-flex align-center rounded-xl"
                dark
                height="200"
                @click="toggle"
              >
                <v-row>
                  <v-col cols="12" sm="12">
                    <v-list-item three-line  class="mt-10">
                      <v-list-item-content>
                        <div class="mb-4">

                            <v-icon  x-large :color="active ? 'white' : '#49D9A0'">fas fa-search</v-icon>

                        </div>
                        <v-list-item-subtitle :class="active ? 'white--text' : 'black--text'">Endpoints</v-list-item-subtitle>
                        <v-list-item-title class="headline mb-1" :class="active ? 'white--text' : 'black--text'">
                          <strong>{{ statistics.total_endpoints }}</strong>
                        </v-list-item-title>

                      </v-list-item-content>
                    </v-list-item>
                  </v-col>
                </v-row>

              </v-card>
            </v-item>
          </v-col>
          <v-col
            cols="12"
            md="2"
          >
            <v-item v-slot="{ active, toggle }">
              <v-card
                :color="active ? '#49D9A0' : 'white'"
                class="d-flex align-center rounded-xl"
                dark
                height="200"
                @click="toggle"
              >
                <v-row>
                  <v-col cols="12" sm="12">
                    <v-list-item three-line  class="mt-10">
                      <v-list-item-content>
                        <div class="mb-4">

                            <v-icon  x-large :color="active ? 'white' : '#49D9A0'">fas fa-search</v-icon>

                        </div>
                        <v-list-item-subtitle :class="active ? 'white--text' : 'black--text'">Emails</v-list-item-subtitle>
                        <v-list-item-title class="headline mb-1" :class="active ? 'white--text' : 'black--text'">
                          <strong>{{ statistics.total_emails }}</strong>
                        </v-list-item-title>

                      </v-list-item-content>
                    </v-list-item>
                  </v-col>
                </v-row>

              </v-card>
            </v-item>
          </v-col>
           <v-col
            cols="12"
            md="2"
          >
            <v-item v-slot="{ active, toggle }">
              <v-card
                :color="active ? '#49D9A0' : 'white'"
                class="d-flex align-center rounded-xl"
                dark
                height="200"
                @click="toggle"
              >
                <v-row>
                  <v-col cols="12" sm="12">
                    <v-list-item three-line  class="mt-10">
                      <v-list-item-content>
                        <div class="mb-4">

                            <v-icon  x-large :color="active ? 'white' : '#49D9A0'">fas fa-search</v-icon>

                        </div>
                        <v-list-item-subtitle :class="active ? 'white--text' : 'black--text'">Vulnerabilities</v-list-item-subtitle>
                        <v-list-item-title class="headline mb-1" :class="active ? 'white--text' : 'black--text'">
                          <strong>23</strong>
                        </v-list-item-title>

                      </v-list-item-content>
                    </v-list-item>
                  </v-col>
                </v-row>

              </v-card>
            </v-item>
          </v-col>

        </v-row>

      </v-container>
    </v-item-group>
   <v-row class="mt-n6">
          <v-col cols="12" sm="7">



         <v-chart class="chart mt-2" :option="option" />


          </v-col>
          <v-col cols="12" md="5" sm="12">
             <v-toolbar color="rgba(0,0,0,0)" flat class="mt-n2">
         <v-toolbar-title> Last  5 Vulnerabilities</v-toolbar-title>
           <v-spacer></v-spacer>

       </v-toolbar>
         <v-simple-table class="grey lighten-3">
      <template v-slot:default>
        <tbody>
          <tr
            v-for="item in  statistics.top_five_vulns"
            :key="item.id"
          >
            <td>{{ item.id }}</td>
            <td>{{ item.name }}</td>
            <td>{{ item.severity }}</td>

          </tr>
        </tbody>
      </template>
    </v-simple-table>
          </v-col>
        </v-row>
         <v-toolbar color="rgba(0,0,0,0)" flat class="mt-n8">
         <v-toolbar-title>Scan Data</v-toolbar-title>

       </v-toolbar> <v-spacer></v-spacer>

       <v-card class=" rounded-lg" width="">
         <v-row>
           <v-col >
             <v-list
        subheader
        two-line

      >
        <v-list-item

        >

          <v-list-item-content>
            <v-list-item-title >Created Tasks</v-list-item-title>

            <v-list-item-subtitle>{{statistics.created}}</v-list-item-subtitle>
          </v-list-item-content>

        </v-list-item>
      </v-list>

           </v-col>
           <v-col >
             <v-list
        subheader
        two-line

      >
        <v-list-item

        >

          <v-list-item-content>
            <v-list-item-title >Tasks in progress</v-list-item-title>

            <v-list-item-subtitle>{{ statistics.running }}</v-list-item-subtitle>
          </v-list-item-content>

        </v-list-item>
      </v-list>

           </v-col>
           <v-col >
             <v-list
        subheader
        two-line

      >
        <v-list-item

        >

          <v-list-item-content>
            <v-list-item-title >Tasks Done</v-list-item-title>

            <v-list-item-subtitle>{{ statistics.done }}</v-list-item-subtitle>
          </v-list-item-content>

        </v-list-item>
      </v-list>

           </v-col>
           <v-col >
             <v-list
        subheader
        two-line

      >
        <v-list-item

        >

          <v-list-item-content>
            <v-list-item-title >Tasks in Pending</v-list-item-title>

            <v-list-item-subtitle> {{ statistics.pending }} </v-list-item-subtitle>
          </v-list-item-content>

        </v-list-item>
      </v-list>

           </v-col>

           <v-col cols="12" sm="3">
             <v-list
        subheader
        two-line

      >
        <v-list-item

        >

          <v-list-item-content>
            <v-list-item-title >Failed tasks</v-list-item-title>

            <v-list-item-subtitle> {{ statistics.failed }} </v-list-item-subtitle>
          </v-list-item-content>

        </v-list-item>
      </v-list>

           </v-col>
         </v-row>
       </v-card>




    </v-container>
  </v-app>

  </template>

  <script>
  import http from "@/http";



    import { use } from "echarts/core";
  import { CanvasRenderer } from "echarts/renderers";
  import { PieChart } from "echarts/charts";
  import {
    TitleComponent,
    TooltipComponent,
    LegendComponent
  } from "echarts/components";
  import VChart, { THEME_KEY } from "vue-echarts";

  use([
    CanvasRenderer,
    PieChart,
    TitleComponent,
    TooltipComponent,
    LegendComponent
  ]);

    export default {
      name: 'Home',
    data: () => ({
      toggle_exclusive: 1,
      statistics: null,
       orders: [
            {
              id: 'CVE ',
              title: 'Teleport v10.1.1 - Remote Code Execution (RCE)',
              state: 'Scanned',
              count: 7.1,
              icon: 'fas fa-ellipsis-h'
            },
            {
              id: 'CVE',
              title: 	"Blink1Control2 2.2.7 - Weak Password Encryption",
              state: 'Scanned',
              count: 7.1,
              icon: 'fas fa-ellipsis-h'
            },
            {
              id: 'CVE',
              title: 'Bookwyrm v0.4.3 - Authentication Bypass',
              state: 'Scanned',
              count: 7.1,
              icon: 'fas fa-ellipsis-h'
            },
            {
              id: 'CVE',
              title: "NanoCMS v0.4 - Remote Code Execution (RCE) (Authenticated)",
              state: 'Scanned',
              count: 7.1,
              icon: 'fas fa-ellipsis-h'
            },

          ],

  option: {
          title: {
            text: "Statistics",
            left: "left"
          },
          tooltip: {
            trigger: "item",
            formatter: "{a} <br/>{b} : {c} ({d}%)"
          },

          series: [
            {
              name: "Vulnerabilities",
              type: "pie",
              radius: "55%",
              center: ["45%", "50%"],
              data: [

                { value: 1548, name: "Info" },
                { value: 135, name: "Low" },
                { value: 310, name: "Medium" },
                { value: 234, name: "High" },
                { value: 335, name: "Critical" },

              ],
              emphasis: {
                itemStyle: {
                  shadowBlur: 10,
                  shadowOffsetX: 0,
                  shadowColor: "rgba(0, 0, 0, 0)"
                }
              }
            }
          ]
  }

    }),
      components: {


     VChart

      },
       methods: {
       async get_stats(){
        const response = (await http.getList('Dashboard')).data;
        this.statistics = response;
        console.log(response);
      ;

       }
        },
      provide: {
      [THEME_KEY]: "green"
    },
    async created(){
      console.log('created');
      await this.get_stats();

        this.option.series[0].data[0].value = this.statistics.info_vulns;
          this.option.series[0].data[1].value = this.statistics.low_vulns;
          this.option.series[0].data[2].value = this.statistics.medium_vulns;
          this.option.series[0].data[3].value = this.statistics.high_vulns;
          this.option.series[0].data[4].value = this.statistics.critical_vulns;

    },
    }
  </script>
  <style>

  .space{
    margin-left: -100px;
    margin-right: -100px;
  }


  </style>
