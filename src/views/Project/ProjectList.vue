<template>

  <div>
      <DataTableVue :items="projects"  :totalitems="totalprojects" :title="title" :headers="headers"
          :formTitle="formTitle" :url="url" :type_of_items="type_of_items" :totalPages="totalPages"
          @get-items="retrieveProjects">
          <template v-slot:scan>
              <v-btn color="primary" dark class="mb-2 ma-2" @click="openScanModal">
                  Scan
              </v-btn>
          </template>
          <template v-slot:createmodal>

              <v-dialog hide-overlay v-model="CreateDialog" max-width="500px">
                                  <template v-slot:activator="{ on, attrs }">
                                      <v-btn color="primary" dark class="mb-2 ma-2" v-bind="attrs" v-on="on">
                                          Add Project
                                      </v-btn>
                                  </template>
              <v-card>
                  <v-card-title>
                      <span class="text-h5">Create Project</span>
                  </v-card-title>

                  <v-card-text>

                      <v-container>
                          <v-row>
                              <v-col cols="12" sm="6" md="4">
                                  <v-text-field v-model="CreateItem.name" label="name"></v-text-field>
                              </v-col>



                          </v-row>
                      </v-container>
                  </v-card-text>
                  <v-card-actions>
                      <v-spacer></v-spacer>
                      <v-btn color="blue darken-1" text @click="closeCreateModal">
                          Cancel
                      </v-btn>
                      <v-btn color="blue darken-1" text @click="save">
                          Save
                      </v-btn>
                  </v-card-actions>

              </v-card>

              </v-dialog>

          </template>
          <template v-slot:filters_after_project>

                       <td>
                   <v-text-field v-model="name" type="string" label=" search by name"></v-text-field>
                       </td>
          </template>


      </DataTableVue>

  </div>
  </template>

  <script>
  import http from "@/http";
  import DataTableVue from "@/components/DataTable.vue";
  export default {
      components: {
          DataTableVue,

      },
      name: "project-list",
      data() {
          return {
              type_of_items: "projects",
              url: "common/projects/",
              formTitle: "Create Project",
              title: "Projects",
              projects: [],
              singleSelect: false,
              totalprojects: 0,
              selected: [],
              detail_dialog: false,
              detail_dialog: false,
              name: "",




              detail_item: null,

              CreateItem: {
                  name: "",


              },
              headers: [
                  { text: "ID", align: "start", sortable: false, value: "id" },
                  { text: "Project Name", sortable: false, value: "project" },


              ],
              page: 1,
              totalPages: 0,
              pageSize: 6,
              pageSizes: [6, 9, 12],
              dialogRunWorker: false,
              CreateDialog: false,

          };
      },
      methods: {
          getRequestParams(name) {
              let params = {};
              if (name) {
                  params["name"] = name;
              }


              return params;
          },
          retrieveProjects(params) {

              let extra_params = this.getRequestParams(this.name);
              params = { ...params, ...extra_params };
              http.getList("Projects", params, true)
                  .then((response) => {
                      const { count, results, total_pages } = response.data;
                      this.totalprojects = count;
                      this.projects = results.map(this.getDisplayProject);
                      this.totalPages = total_pages;
                      console.log(response.data);
                  })
                  .catch((e) => {
                      console.log(e);
                  });
          },
          handlePageChange(value) {
              this.page = value;
              this.retrieveProjects();
          },
          handlePageSizeChange(size) {
              this.pageSize = size;
              this.page = 1;
              this.retrieveProjects();
          },






          refreshList() {
              this.retrieveProjects();
          },

          deleteProject(id) {
              http.deleteItem("Projects", id)
                  .then(() => {
                      this.refreshList();
                  })
                  .catch((e) => {
                      console.log(e);
                  });
          },
          getDisplayProject(project) {
              return {
                  id: project.id,
                  project: project.name,

              };
          },

          async save() {
              let post_data = {
                name: this.CreateItem.name,

              }

              let response = (
                  await http.createItem(
                      "Projects",
                     post_data
                      ,
                      true
                  )
              )
              this.closeCreateModal()
              window.location.reload()
          },

          closeDetailModal() {
              this.detail_dialog = false
              this.$nextTick(() => {
                  this.detail_item - null
              })

          },
          OpenDetailCard(item){
              this.detail_dialog = true
              this.detail_item = item
          },



          closeCreateModal() {
              this.CreateDialog = false
              this.$nextTick(() => {
                  this.CreateItem = Object.assign({}, {

              name: "",

          })
              })
          },
      },
      mounted() {
          let params = {
              page: this.page,
              per_page: this.pageSize,
          };
          this.retrieveProjects(params);


      },

      watch: {
          CreatDialog(val) {
              val || this.closeCreateModal()
          },


          UpdatingIps(val){
              this.GetIps(val)
          },
          UpdatingProjects(val){
              this.getProjects(val)
          }

      },
  };
  </script>

  <style>
  .list {
      max-width: 750px;
  }
  </style>
    Footer
